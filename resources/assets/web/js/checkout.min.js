$(document).ready(function() {

	variable = $('.variable').data('value');
	variable = atob(variable);
	lang = JSON.parse(variable);

	// Đóng popup thông báo giỏ hàng
	$('body').on('click', '*[data-cart_popup_close]', function(e) {
		e.preventDefault();
		e.stopImmediatePropagation();
		$('body').css('overflow', 'auto');
		$(this).closest('.open').removeClass('open');
	});

	$('body').on('click', '.checkout-error span', function(e) {
		e.preventDefault();
		e.stopImmediatePropagation();
		$(this).closest('.checkout-error').fadeOut(function() {
			$(this).remove();
		});
	})
	
	$('body').on('click', '.checkout-form-submit button[type=submit]', function(e) {
		e.preventDefault();
		form = $(this).closest('.checkout-form-submit');
		customer_name = form.find('input[name=customer_name]').val();
		customer_phone = form.find('input[name=customer_phone]').val();
		customer_email = form.find('input[name=customer_email]').val();
		payment_method = form.find('input[name=payment_method]').val();
		if (customer_name == '' || customer_phone == '' || customer_email == '') {
			checkoutAlert(lang.require_customer);
		} else if (!checkoutPhone(customer_phone)) {
			checkoutAlert(lang.require_customer_phone_format);
		} else if (!checkoutEmail(customer_email)) {
			checkoutAlert(lang.require_customer_email_format);
		} else if (!payment_method) {
			checkoutAlert(lang.require_payment_method);
		} else {
			form.submit();
		}
	});

})

// check định dạng email
function checkoutEmail(email) {
	var re = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
	return re.test(String(email).toLowerCase());
}
// check định dạng điện thoại
function checkoutPhone(phone) {
	var flag = false;
	phone = phone.trim();
    phone = phone.replace('(+84)', '0');
    phone = phone.replace('+84', '0');
    phone = phone.replace('0084', '0');
    phone = phone.replace(/ /g, '');
    if (phone != '') {
        if (phone.length >= 9 && phone.length <=11) {
        	flag = true;
        } else {
        	flag = false;
        }
    }
    return flag;
}
// Thông báo
function checkoutAlert(text) {
	$('#checkout-notificate').find('.cart-popup__body__notificate').html(text);
	$('#checkout-notificate').addClass('open');
	$('body').css('overflow', 'hidden');
}